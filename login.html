<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scholarly | Welcome</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="login.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="login-container">
    <div class="login-branding">
      <div class="branding-content">
        <div class="logo">ðŸ“š Scholarly</div>
        <h2>Make Learning an Adventure!</h2>
        <p>Track your progress, complete quests, and get help from your AI study buddy. Your academic journey starts here.</p>
      </div>
    </div>
    <div class="login-form-area">
      <input type="checkbox" id="flip">
      <div class="forms-wrapper">
        <div class="form login-form">
          <div class="title">Welcome Back!</div>
          <form id="loginForm">
            <div class="input-box"><i class="fas fa-envelope"></i><input type="email" placeholder="Email" required id="login-email"></div>
            <div class="input-box"><i class="fas fa-lock"></i><input type="password" placeholder="Password" required id="login-password"></div>
            <div class="button input-box"><input type="submit" value="Start Learning!"></div>
            <div class="text">New student? <label for="flip">Sign up now</label></div>
          </form>
        </div>
        <div class="form signup-form">
          <div class="title">Join the Quest</div>
          <form id="signupForm">
            <div class="input-box"><i class="fas fa-envelope"></i><input type="email" placeholder="Your Email" id="signup-email" required></div>
            <div class="input-box"><i class="fas fa-lock"></i><input type="password" placeholder="Create Password" id="signup-password" required></div>
            <div class="input-box"><i class="fas fa-users"></i><input type="email" placeholder="Parent's Email" id="signup-parent-email" required></div>
            <div class="input-box"><i class="fas fa-graduation-cap"></i><select id="signup-board" required><option value="">Select Your Board</option><option value="CBSE">CBSE</option><option value="ICSE">ICSE</option><option value="MAHARASHTRA">Maharashtra</option></select></div>
            <div class="input-box"><i class="fas fa-school"></i><select id="signup-class" required><option value="">Select Your Class</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select></div>
            <div class="input-box" id="stream-selection" style="display:none;"><i class="fas fa-book"></i><select id="signup-stream"><option value="">Select Stream</option><option value="Science">Science</option><option value="Commerce">Commerce</option><option value="Arts">Arts</option></select></div>
            <div class="button input-box"><input type="submit" value="Begin Adventure"></div>
            <div class="text">Already a member? <label for="flip">Login now</label></div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <script>
    const API_URL = "http://localhost:5000";
    document.getElementById("signup-class").addEventListener("change", e => {
      const streamDiv = document.getElementById("stream-selection");
      if (e.target.value === "11" || e.target.value === "12") {
        streamDiv.style.display = "block";
        document.getElementById("signup-stream").required = true;
      } else {
        streamDiv.style.display = "none";
        document.getElementById("signup-stream").required = false;
      }
    });
    document.getElementById("signupForm").addEventListener("submit", async e => {
      e.preventDefault();
      const signupData = {
        email: document.getElementById("signup-email").value,
        password: document.getElementById("signup-password").value,
        parent_email: document.getElementById("signup-parent-email").value,
        studentClass: document.getElementById("signup-class").value,
        board: document.getElementById("signup-board").value,
        stream: document.getElementById("signup-stream").value || null
      };
      try {
        const res = await fetch(`${API_URL}/signup`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(signupData) });
        const data = await res.json();
        if (res.ok) {
          alert(`Welcome to Scholarly! ðŸŽ‰\nPlease login to start your adventure!`);
          document.getElementById("flip").checked = false;
          document.getElementById("signupForm").reset();
        } else { alert("Signup failed: " + data.error); }
      } catch (err) { alert("Connection error. Is the server running?"); }
    });
    document.getElementById("loginForm").addEventListener("submit", async e => {
      e.preventDefault();
      try {
        const res = await fetch(`${API_URL}/login`, { method: "POST", headers: { "Content-Type": "application/json" }, credentials: 'include', body: JSON.stringify({ email: document.getElementById("login-email").value, password: document.getElementById("login-password").value }) });
        if (res.ok) { window.location.href = "index.html"; } 
        else { const data = await res.json(); alert("Login failed: " + data.error); }
      } catch (err) { alert("Connection error. Is the server running?"); }
    });
  </script>
</body>
</html>